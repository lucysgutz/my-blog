<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>lucy's space</title>
<link rel="stylesheet" href="css/styles.css">
</head>
<body>

<div id="enterScreen" class="panel">
  <h1>WHO'S THERE?</h1>
  <div class="enter-actions">
    <button id="enterBtn">ENTER</button>
  </div>
</div>

<div class="masthead">
  <h1 class="logo glow">~*lucy's space*~</h1>
  <h2 class="blink">under construction</h2>
  <div id="retroClock" aria-hidden="true"></div>
</div>

<table>
<tr>
<td colspan="2">
  <div class="retro-marquee"><marquee behavior="scroll" direction="left">down with the elephant, down with the ass! build a party for the working class!</marquee></div>
</td>
</tr>
<tr>
<td width="50%">
  <table border="1" cellpadding="5">
    <tr><td><p>hiya! im lucy, a 15 year old kid from the new york suburbs, im a beginner software engineer & amateur web developer.</p></td></tr>
    <tr><td>
      <div class="badges">
        <img loading="lazy" src="badges/iebad.gif" alt="IE badge">
        <img loading="lazy" src="badges/linuxnow.gif" alt="Linux badge">
        <img loading="lazy" src="badges/ieexploit.gif" alt="IE exploit badge">
        <img loading="lazy" src="badges/transnow2.gif" alt="trans badge">
        <img loading="lazy" src="badges/bloodcovered.gif" alt="blood covered badge">
        <img loading="lazy" src="badges/deletetwitter.gif" alt="deletetwitter badge">
      </div>
    </td></tr>
  </table>
</td>
<td width="50%">
  <table border="1" cellpadding="5">
    <tr><td><h2>latest blog post</h2></td></tr>
    <tr><td><marquee behavior="scroll" direction="left">10/7/2025</marquee></td></tr>
    <tr><td><p>rethemed my page guys how do we like it!</p></td></tr>
  </table>
</td>
</tr>
</table>

<section id="projects">
    <div class="projects-header">
    <h2>Projects</h2>
    <div>
      <button id="refreshProjects">Refresh</button>
      <button id="sortProjects" class="sort-btn" data-sort="updated">Sort: Updated</button>
    </div>
  </div>
  <div id="projectsList">Loading projects…</div>
</section>

<div id="currentTrack">Now Playing: none</div>

<button id="backToTop" aria-label="Back to top">top</button>

<script>
  for(let i=0;i<50;i++){
    let star = document.createElement('div');
    star.className = 'star';
    star.style.left = Math.random() * window.innerWidth + 'px';
    star.style.top = Math.random() * window.innerHeight + 'px';
    star.style.animationDuration = (2 + Math.random()*3) + 's';
    document.body.appendChild(star);
  }

  document.getElementById('enterBtn').addEventListener('click', () => {
    document.getElementById('enterScreen').style.display = 'none';

    const tracks = [
      "setlist/kill.mp3",
      "setlist/the more you know.mp3",
      "setlist/I plan to leave the internet fuck your trend.mp3"
    ];

    const audio = document.createElement('audio');
    audio.autoplay = true;
    audio.volume = 0.3;
    document.body.appendChild(audio);

    let current = 0;
    function playTrack(i){
      audio.src = tracks[i];
      audio.play();
      document.getElementById('currentTrack').textContent = 'Now Playing: ' + tracks[i].split('/')[1];
    }

    audio.addEventListener('ended', () => {
      current++;
      if(current < tracks.length){
        playTrack(current);
      } else {
        document.getElementById('currentTrack').textContent = 'Now Playing: none';
      }
    });

    playTrack(current);
  });
</script>

<!-- README Modal -->
<div id="modalBackdrop" class="modal-backdrop" style="display:none" aria-hidden="true">
  <div class="modal" role="document">
    <button class="close" aria-label="Close">✕</button>
    <h3 id="modalTitle">Repository</h3>
    <div id="modalContent">Loading…</div>
  </div>
</div>

<script>
  // modal + readme fetch + burst animation
  const modalBackdrop = document.getElementById('modalBackdrop');
  const modalTitle = document.getElementById('modalTitle');
  const modalContent = document.getElementById('modalContent');
  modalBackdrop.addEventListener('click', (e)=>{ if(e.target === modalBackdrop) closeModal(); });
  modalBackdrop.querySelector('.close').addEventListener('click', closeModal);

  function openModal(){ modalBackdrop.style.display='flex'; modalBackdrop.classList.add('show'); modalBackdrop.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
  function closeModal(){ modalBackdrop.classList.remove('show'); modalBackdrop.setAttribute('aria-hidden','true'); setTimeout(()=> modalBackdrop.style.display='none',180); document.body.style.overflow=''; }

  async function openReadmeModal(owner, repo, title, url, description){
    modalTitle.textContent = title;
    modalContent.textContent = 'Loading README…';
    openModal();
    try{
      const resp = await fetch(`https://api.github.com/repos/${owner}/${repo}/readme`, { headers: { Accept: 'application/vnd.github.v3.raw' } });
      if(!resp.ok) throw new Error('No README');
      const txt = await resp.text();
      // simple markdown -> plaintext fallback (avoid heavy libs)
      modalContent.textContent = txt;
      // add a raw link
      const link = document.createElement('a'); link.href = url; link.target='_blank'; link.rel='noopener noreferrer'; link.textContent = 'Open repository on GitHub'; link.style.display='block'; link.style.marginTop='12px';
      modalContent.appendChild(link);
    }catch(err){
      modalContent.textContent = 'No README available.';
    }
  }

  // close on Escape
  document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && modalBackdrop.classList.contains('show')) closeModal(); });

  // spawn a small burst animation at screen coords
  function spawnBurst(x,y){
    const el = document.createElement('div'); el.className='burst'; document.body.appendChild(el);
    el.style.left = x + 'px'; el.style.top = y + 'px';
    requestAnimationFrame(()=> el.classList.add('animate'));
    setTimeout(()=> el.remove(), 700);
  }
</script>

<script>
  // Enhanced projects loader with local cache and refresh button
  (function(){
    const listEl = document.getElementById('projectsList');
    const refreshBtn = document.getElementById('refreshProjects');
    const CACHE_KEY = 'github_repos_lucy407_v1';
    const CACHE_TTL = 1000 * 60 * 10; // 10 minutes

    let currentSort = 'updated';
    const sortBtn = document.getElementById('sortProjects');
    sortBtn.addEventListener('click', ()=>{
      // cycle sorts: updated -> stars -> name -> updated
      currentSort = currentSort === 'updated' ? 'stars' : currentSort === 'stars' ? 'name' : 'updated';
      sortBtn.textContent = currentSort === 'updated' ? 'Sort: Updated' : currentSort === 'stars' ? 'Sort: Stars' : 'Sort: Name';
      fetchAndRender(true);
    });

    function render(repos){
      if(!repos || repos.length === 0){ listEl.textContent = 'No public projects found.'; return; }
      const container = document.createElement('div');
      container.className = 'repo-list';
      if(currentSort === 'updated') repos.sort((a,b)=> new Date(b.updated_at)-new Date(a.updated_at));
      else if(currentSort === 'stars') repos.sort((a,b)=> (b.stargazers_count||0) - (a.stargazers_count||0));
      else repos.sort((a,b)=> (a.name||'').localeCompare(b.name||''));
      repos.forEach(r => {
        const item = document.createElement('div');
        item.className = 'repo panel';
        item.setAttribute('tabindex','0');
        item.setAttribute('role','button');
        item.dataset.clone = r.clone_url;
        item.dataset.owner = r.owner.login;
        item.dataset.repo = r.name;
        item.innerHTML = `
          <div class="repo-head"><a href="${r.html_url}" target="_blank" rel="noopener noreferrer">${r.name}</a></div>
          ${r.description?`<p>${r.description}</p>`:''}
          <div class="meta">⭐ ${r.stargazers_count} • ${r.language || '—'} • updated ${new Date(r.updated_at).toLocaleDateString()}</div>
          <div class="repo-controls">
            <button class="detailsBtn">Details</button>
            <button class="copyBtn">Copy Clone</button>
            <a class="openBtn" href="${r.html_url}" target="_blank" rel="noopener noreferrer">Open</a>
          </div>
          <div class="repo-details" aria-hidden="true" style="display:none"></div>
        `;

        // attach interactive handlers with closures
        (function(repo, el){
          const detailsEl = el.querySelector('.repo-details');
          const detailsBtn = el.querySelector('.detailsBtn');
          const copyBtn = el.querySelector('.copyBtn');

          detailsBtn.addEventListener('click', (ev)=>{
            // open a modal with the README fetched on demand
            ev.preventDefault();
            openReadmeModal(repo.owner.login, repo.name, repo.name, repo.html_url, repo.description);
          });

          copyBtn.addEventListener('click', async (ev)=>{
            try{
              await navigator.clipboard.writeText(repo.clone_url);
              showToast('Clone URL copied');
              spawnBurst(ev.clientX, ev.clientY);
            }catch(e){
              showToast('Copy failed');
            }
          });
        })(r, item);

        container.appendChild(item);
      });
      listEl.innerHTML = '';
      listEl.appendChild(container);

      // reveal on scroll
      const observer = new IntersectionObserver((entries)=>{
        entries.forEach(en=>{ if(en.isIntersecting) en.target.classList.add('visible'); });
      },{threshold:0.12});
      container.querySelectorAll('.repo').forEach(el=>observer.observe(el));

      // keyboard navigation inside repo list
      let focusedIndex = 0;
      const items = Array.from(container.querySelectorAll('.repo'));
      items.forEach((it, idx)=>{
        it.addEventListener('keydown', (ev)=>{
          if(ev.key === 'ArrowDown'){ ev.preventDefault(); const next = items[(idx+1)%items.length]; next.focus(); }
          else if(ev.key === 'ArrowUp'){ ev.preventDefault(); const prev = items[(idx-1+items.length)%items.length]; prev.focus(); }
          else if(ev.key === 'Enter'){ ev.preventDefault(); const btn = it.querySelector('.detailsBtn'); btn && btn.click(); }
          else if(ev.key.toLowerCase() === 'c'){ ev.preventDefault(); const clone = it.dataset.clone; navigator.clipboard && navigator.clipboard.writeText(clone).then(()=>showToast('Clone URL copied')); }
        });
      });
    }

    function setCache(data){
      try{ localStorage.setItem(CACHE_KEY, JSON.stringify({ts:Date.now(),data})); }catch(e){}
    }

    function getCache(){
      try{ const raw = localStorage.getItem(CACHE_KEY); if(!raw) return null; const parsed = JSON.parse(raw); if(Date.now()-parsed.ts > CACHE_TTL) return null; return parsed.data;}catch(e){return null}
    }

    function fetchAndRender(force=false){
      const cached = getCache();
      if(cached && !force){ render(cached); return; }
      listEl.textContent = 'Loading projects…';
      fetch('https://api.github.com/users/lucy407/repos?per_page=100')
        .then(res => {
          if(!res.ok) throw new Error('GitHub API error ' + res.status);
          return res.json();
        })
        .then(repos => { setCache(repos); render(repos); })
        .catch(err => {
          const fallback = getCache();
          if(fallback){ render(fallback); }
          else listEl.textContent = 'Could not load projects: ' + err.message;
        });
    }

    refreshBtn.addEventListener('click', ()=>{ fetchAndRender(true); });
    fetchAndRender();

    // removed project search per user request
  })();
</script>

<script>
  // QoL: keyboard/UX improvements for the enter screen and audio
  (function(){
    const enter = document.getElementById('enterBtn');
    const enterScreen = document.getElementById('enterScreen');

    function hideIntro(){
      enterScreen.classList.add('fade-out');
      setTimeout(()=> enterScreen.style.display='none',450);
    }

    enter.addEventListener('click', hideIntro);

    // allow Enter or Space to dismiss when focused
    document.addEventListener('keydown', (e)=>{
      if(document.body.contains(enterScreen) && enterScreen.style.display !== 'none'){
        if(e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar'){
          e.preventDefault(); hideIntro();
        }
        if(e.key === 'Escape'){
          e.preventDefault(); hideIntro();
        }
      }
    });
  })();

  // small retro clock and back-to-top logic
  (function(){
    const clock = document.getElementById('retroClock');
    function tick(){
      try{
        // Use Intl to format time in Eastern Time (handles EST/EDT automatically)
        const now = new Date();
        const parts = new Intl.DateTimeFormat('en-US', {
          timeZone: 'America/New_York',
          hour12: true,
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit'
        }).formatToParts(now).reduce((acc, p) => { acc[p.type] = p.value; return acc; }, {});
        const period = parts.dayPeriod || parts.period || '';
        clock.textContent = `${parts.hour}:${parts.minute}:${parts.second}${period? ' ' + period : ''}`;
      }catch(e){
        // Fallback to local 12-hour time if Intl or timezone isn't available
        const d = new Date();
        let h = d.getHours();
        const period = h >= 12 ? 'PM' : 'AM';
        h = h % 12 || 12; // convert 0 => 12
        const hh = String(h).padStart(2,'0');
        const mm = String(d.getMinutes()).padStart(2,'0');
        const ss = String(d.getSeconds()).padStart(2,'0');
        clock.textContent = `${hh}:${mm}:${ss} ${period}`;
      }
    }
    if(clock) setInterval(tick,1000), tick();

    const back = document.getElementById('backToTop');
    window.addEventListener('scroll', ()=>{ if(window.scrollY > 220) back.classList.add('show'); else back.classList.remove('show'); });
    back.addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));
  })();

  // Fade-in body once JS runs
  document.documentElement.classList.remove('fade-in');
  document.documentElement.classList.add('loaded');

  // small toast helper
  function showToast(msg){
    let t = document.querySelector('.toast');
    if(!t){ t = document.createElement('div'); t.className='toast'; document.body.appendChild(t); }
    t.textContent = msg; t.classList.add('show');
    clearTimeout(t._t);
    t._t = setTimeout(()=> t.classList.remove('show'),2000);
  }
</script>

</body>
</html>
