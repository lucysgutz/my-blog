<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>lucys.space</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --glass-bg: rgba(20, 20, 20, 0.6);
    --glass-border: rgba(255, 255, 255, 0.1);
    --accent: #aaddff;
  }

  * { box-sizing: border-box; }

  body {
    margin: 0;
    background: #000;
    color: #f0f0f0;
    font-family: 'Space Grotesk', sans-serif;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
  }

  body.active-site {
    overflow-y: auto;
    overflow-x: hidden;
  }

  canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
    pointer-events: auto; 
  }

  #startScreen {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 4vw;
    cursor: pointer;
    background: #000;
    z-index: 50;
    transition: opacity 1s ease;
  }

  #lyrics {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    white-space: pre-line;
    font-size: 2rem;
    opacity: 1;
    z-index: 10;
    pointer-events: none;
    text-shadow: 0 0 15px rgba(255,255,255,0.3);
    width: 80%;
  }

  #skipBtn {
    position: fixed;
    bottom: 10%;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 32px;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 50px;
    color: white;
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1rem;
    cursor: pointer;
    opacity: 0;
    pointer-events: none; 
    z-index: 60; 
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
    text-transform: lowercase; 
  }

  #skipBtn.visible {
    opacity: 1;
    pointer-events: auto;
  }

  #skipBtn:hover {
    background: rgba(255,255,255,0.2);
    border-color: white;
  }

  #musicPopup {
    position: fixed;
    bottom: 30px;
    right: 30px;
    display: flex;
    align-items: center;
    gap: 15px;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(10px);
    padding: 10px 20px 10px 10px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.1);
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.8s cubic-bezier(0.19, 1, 0.22, 1);
    z-index: 90;
  }

  #musicPopup.show {
    transform: translateY(0);
    opacity: 1;
  }

  #musicPopup img {
    width: 50px;
    height: 50px;
    border-radius: 6px;
    object-fit: cover;
  }

  #musicPopup .info {
    display: flex;
    flex-direction: column;
  }

  #musicPopup .label {
    font-size: 0.75rem;
    color: #888;
    text-transform: lowercase; 
    letter-spacing: 1px;
  }

  #musicPopup .song-name {
    font-size: 1rem;
    color: #fff;
  }

  #mainContent {
    display: none;
    position: relative;
    z-index: 20;
    min-height: 100vh;
    padding-top: 100px;
    background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.8) 80%);
  }

  nav {
    position: fixed;
    top: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(12px);
    padding: 10px 30px;
    border-radius: 50px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 100;
    display: flex;
    gap: 30px;
  }

  nav a {
    color: #ccc;
    text-decoration: none;
    font-size: 0.95rem;
    transition: color 0.3s;
    text-transform: lowercase; 
  }

  nav a:hover, nav a.active {
    color: #fff;
    text-shadow: 0 0 10px rgba(255,255,255,0.5);
  }

  .content-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 40px 20px 100px;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.8s ease, transform 0.8s ease;
  }

  .content-container.fade-in {
    opacity: 1;
    transform: translateY(0);
  }

  .hero-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 20px;
    margin-bottom: 60px;
  }

  .hero-title {
    font-size: 4rem;
    font-weight: 600;
    background: linear-gradient(to right, #fff, #aaa);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin: 0;
    text-transform: lowercase; 
  }

  .hero-subtitle {
    font-size: 1.2rem;
    color: #888;
    max-width: 600px;
    line-height: 1.6;
  }

  .about-card {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    padding: 40px;
    border-radius: 20px;
    backdrop-filter: blur(10px);
    margin-top: 40px;
    text-align: left;
  }

  .about-card h2 {
    text-transform: lowercase; 
  }
  
  .project-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
  }

  .card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 25px;
    transition: transform 0.3s, background 0.3s;
    cursor: pointer;
  }

  .card:hover {
    transform: translateY(-5px);
    background: rgba(255, 255, 255, 0.07);
    border-color: rgba(255, 255, 255, 0.3);
  }

  .card h3 { margin: 0 0 10px 0; font-size: 1.2rem; }
  .card p { color: #aaa; font-size: 0.9rem; line-height: 1.5; }
  .card a { color: var(--accent); text-decoration: none; display: inline-block; margin-top: 15px; }

  .flash-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: white;
    opacity: 0;
    pointer-events: none;
    z-index: 200;
  }
</style>
</head>
<body>

<div id="startScreen">click to enter</div>

<div id="lyrics"></div>

<button id="skipBtn">skip intro</button>

<div id="musicPopup">
  <img src="makka.png" alt="cover" onerror="this.src='https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fis1-ssl.mzstatic.com%2Fimage%2Fthumb%2FMusic221%2Fv4%2Fb6%2F97%2Fad%2Fb697ad6f-b61d-f200-0f19-807c4472e93e%2F840471804079.png%2F1200x630bf-60.jpg&f=1&nofb=1&ipt=67b9ad4488a94cc9acc4af2e01cdaa53afd40ece65935af05222dc5a28223f22'">
  <div class="info">
    <span class="label">now playing</span>
    <span class="song-name">makka - fakemink</span>
  </div>
</div>

<audio id="music" src="makkafakemink.mp3" loop></audio>

<div class="flash-overlay"></div>

<div id="mainContent">
  <nav>
    <a href="#" class="nav-link active" data-page="home">home</a>
    <a href="#" class="nav-link" data-page="projects">projects</a>
    <a href="#" class="nav-link" data-page="blog">blog</a>
  </nav>

  <div id="dynamicContent" class="content-container"></div>
</div>

<script>
let scene, camera, renderer;
let starGeo, starMat, starLines;
let warpSpeed = 0.5; 
let targetSpeed = 0.5;
let isDragging = false;
let mouseX = 0, mouseY = 0;
let camRotX = 0, camRotY = 0;

const STAR_COUNT = 4000;
const BOUNDARY_Z = 2000;

function initThree() {
    scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x000000, 0.0006);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 3000);
    camera.position.z = 0;
    camera.rotation.x = Math.PI / 2; 

    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    document.body.appendChild(renderer.domElement);

    const positions = [];
    const colors = [];
    const colorOpts = [
        new THREE.Color(0x88ccff),
        new THREE.Color(0xffffff),
        new THREE.Color(0xaa88ff)
    ];

    for(let i=0; i<STAR_COUNT; i++) {
        const x = (Math.random() - 0.5) * 3000;
        const y = (Math.random() - 0.5) * 3000;
        const z = (Math.random() - 0.5) * BOUNDARY_Z;
        
        positions.push(x, y, z); 
        positions.push(x, y, z); 

        const c = colorOpts[Math.floor(Math.random() * colorOpts.length)];
        colors.push(c.r, c.g, c.b);
        colors.push(c.r, c.g, c.b);
    }

    starGeo = new THREE.BufferGeometry();
    starGeo.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
    starGeo.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

    starMat = new THREE.LineBasicMaterial({
        vertexColors: true,
        transparent: true,
        opacity: 0.8
    });

    starLines = new THREE.LineSegments(starGeo, starMat);
    scene.add(starLines);

    window.addEventListener('resize', onResize);
    window.addEventListener('mousedown', () => isDragging = true);
    window.addEventListener('mouseup', () => isDragging = false);
    window.addEventListener('mousemove', onMouseMove);

    animate();
}

function onResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function onMouseMove(e) {
    if(!isDragging) return;
    const dx = e.movementX || 0;
    const dy = e.movementY || 0;
    camRotY -= dx * 0.001;
    camRotX -= dy * 0.001;
}

function animate() {
    requestAnimationFrame(animate);

    warpSpeed += (targetSpeed - warpSpeed) * 0.05;

    const positions = starGeo.attributes.position.array;
    
    for(let i=0; i < STAR_COUNT; i++) {
        const i3 = i * 6; 

        let x = positions[i3];
        let y = positions[i3+1];
        let z = positions[i3+2];

        z += warpSpeed * 10; 

        if(z > 1000) {
            z -= 2000;
            x = (Math.random() - 0.5) * 3000;
            y = (Math.random() - 0.5) * 3000;
        }

        const tailLen = warpSpeed * 30;

        positions[i3] = x;
        positions[i3+1] = y;
        positions[i3+2] = z;

        positions[i3+3] = x;
        positions[i3+4] = y;
        positions[i3+5] = z - tailLen;
    }

    starGeo.attributes.position.needsUpdate = true;

    camera.rotation.x += (camRotX - camera.rotation.x) * 0.1;
    camera.rotation.y += (camRotY - camera.rotation.y) * 0.1;
    
    renderer.render(scene, camera);
}

const startScreen = document.getElementById('startScreen');
const lyricsDiv = document.getElementById('lyrics');
const skipBtn = document.getElementById('skipBtn');
const music = document.getElementById('music');
const mainContent = document.getElementById('mainContent');
const flashOverlay = document.querySelector('.flash-overlay');
const musicPopup = document.getElementById('musicPopup');
const navLinks = document.querySelectorAll('.nav-link');

let lyrics = [];
let isMainSiteActive = false;
let autoSkipTimer;

startScreen.addEventListener('click', startExperience);

skipBtn.addEventListener('click', (e) => {
    e.stopPropagation(); 
    if(!isMainSiteActive) goMainSite();
});

async function startExperience() {
    startScreen.style.pointerEvents = 'none';
    gsap.to(startScreen, { opacity: 0, duration: 1, onComplete: () => startScreen.style.display = 'none' });
    
    initThree();
    
    try {
        music.volume = 0.8;
        await music.play();
        musicPopup.classList.add('show'); 
    } catch(err) {
        console.log("Audio autoplay block");
    }

    try {
        const res = await fetch('lyricpotato.en_US.srt');
        const text = await res.text();
        lyrics = parseSrt(text);
    } catch(e) {
        lyrics = [{start:0, end:3, text:"welcome..."}];
    }

    music.addEventListener('timeupdate', updateLyrics);

    setTimeout(() => {
        if(!isMainSiteActive) skipBtn.classList.add('visible');
    }, 3000);

    const lastTime = lyrics.length > 0 ? lyrics[lyrics.length-1].end : 10;
    autoSkipTimer = setTimeout(() => {
        if(!isMainSiteActive) goMainSite();
    }, (lastTime + 2) * 1000);
}

function updateLyrics() {
    if(isMainSiteActive) return;
    const t = music.currentTime;
    const line = lyrics.find(l => t >= l.start && t <= l.end);
    lyricsDiv.innerText = line ? line.text : '';
}

function goMainSite() {
    if(isMainSiteActive) return;
    isMainSiteActive = true;
    clearTimeout(autoSkipTimer);

    skipBtn.classList.remove('visible');
    lyricsDiv.style.display = 'none';

    targetSpeed = 40; 

    gsap.to(music, { volume: 0.2, duration: 3 });

    setTimeout(() => {
        gsap.to(flashOverlay, { opacity: 1, duration: 0.2, yoyo: true, repeat: 1 });
    }, 1500);

    setTimeout(() => {
        targetSpeed = 0.8; 
        
        mainContent.style.display = 'block';
        document.body.classList.add('active-site');
        
        loadPage('home');
        
        gsap.to(musicPopup, { bottom: "30px", right: "30px", duration: 1 });
    }, 1800);
}

function parseSrt(srt) {
    const blocks = srt.split('\n\n');
    return blocks.map(b => {
        const lines = b.split('\n');
        if(lines.length < 3) return null;
        const times = lines[1].split(' --> ');
        return {
            start: timeToSec(times[0]),
            end: timeToSec(times[1]),
            text: lines.slice(2).join('\n')
        };
    }).filter(x => x);
}

function timeToSec(str) {
    if(!str) return 0;
    const p = str.replace(',', '.').split(':');
    return (parseFloat(p[0])*3600) + (parseFloat(p[1])*60) + parseFloat(p[2]);
}

navLinks.forEach(link => {
    link.addEventListener('click', (e) => {
        e.preventDefault();
        navLinks.forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        const page = link.dataset.page;
        loadPage(page);
    });
});

async function loadPage(page) {
    const container = document.getElementById('dynamicContent');
    
    container.classList.remove('fade-in');
    
    setTimeout(async () => {
        container.innerHTML = '';
        
        if(page === 'home') {
            container.innerHTML = `
                <div class="hero-section">
                    <h1 class="hero-title">lucys.space</h1> <p class="hero-subtitle">beginner fullstack developer</p> </div>
                <div class="about-card">
                    <h2>about me</h2> <p>
                        im lucy! im a 15 year old developer, i mainly make websites but ive been learning fullstack development recently. im from the new york suburbs & im also a musician part time. i love making cool projects and experimenting with new tech. you can check out my software i make for linux distro's or see my blog to get to know me more!
                    </p>
                    
                </div>
            `;
        } else if(page === 'projects') {
            container.innerHTML = `<h2>selected projects</h2><div id="repo-grid" class="project-grid">loading...</div>`;
            await fetchProjects();
        } else if(page === 'blog') {
            container.innerHTML = `<h2>latest entries</h2><div id="blog-grid" class="project-grid">loading...</div>`;
            await fetchBlog();
        }

        container.classList.add('fade-in');
    }, 300);
}

async function fetchProjects() {
    const grid = document.getElementById('repo-grid');
    try {
        const res = await fetch('https://api.github.com/users/lucy407/repos?sort=updated&per_page=6');
        const data = await res.json();
        grid.innerHTML = '';
        data.forEach(repo => {
            const el = document.createElement('div');
            el.className = 'card';
            el.innerHTML = `
                <h3>${repo.name.toLowerCase()}</h3> <p>${repo.description ? repo.description.toLowerCase() : 'no description provided.'}</p> <a href="${repo.html_url}" target="_blank">view code &rarr;</a> `;
            grid.appendChild(el);
        });
    } catch(e) {
        grid.innerHTML = 'failed to load projects.';
    }
}

async function fetchBlog() {
    const grid = document.getElementById('blog-grid');
    try {
        const res = await fetch('blog.json');
        const data = await res.json();
        grid.innerHTML = '';
        data.forEach(post => {
            const el = document.createElement('div');
            el.className = 'card';
            el.innerHTML = `
                <h3>${post.title.toLowerCase()}</h3> <p>${post.content.substring(0, 100).toLowerCase()}...</p> <a href="#">read more</a> `;
            grid.appendChild(el);
        });
    } catch(e) {
        grid.innerHTML = 'failed to load blog posts.';
    }
}

</script>
</body>
</html>